<!DOCTYPE html>

<!--
	TODO:
	- spinner http://www.switchonthecode.com/tutorials/javascript-controls-the-spin-control
	- event output
-->
<html>  
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>GameGrid.js Test</title>
<style type="text/css">
html, body {
  width:  100%;
  height: 100%;
  margin: 0px;
  font-size:10px;
  font-family:Verdana, Helvetica, sans-serif;
}
input {
  font-size:10px;
}
.spinner {
	width:25px;
}
</style>
<script type="text/javascript" src="GameGrid.js"></script>
<script type="text/javascript" src="EventEmitter.js"></script>
<script type="text/javascript" src="gl-matrix.js"></script>
<script type="text/javascript" src="jscolor/jscolor.js"></script>
<link type="text/css" href="css/smoothness/jquery-ui-1.8.16.custom.css" rel="stylesheet" />
<script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
<script type="text/javascript" src="jquery-ui-1.8.16.custom.min.js"></script>

<!-- spinner -->
<link rel="stylesheet" href="jquery-ui/themes/base/jquery.ui.all.css">
<script src="jquery-ui/external/jquery.mousewheel-3.0.4.js"></script>
<script src="jquery-ui/ui/jquery.ui.core.js"></script>
<script src="jquery-ui/ui/jquery.ui.widget.js"></script>
<script src="jquery-ui/ui/jquery.ui.button.js"></script>
<script src="jquery-ui/ui/jquery.ui.spinner.js"></script>

<script type="text/javascript">
	
	var gameGrid;
	
	function init() {	
		var canvas = document.getElementById("canvas");
		//canvas.onkeypress = keyPressed;
		canvas.height = 500;
		canvas.width = -100;
		gameGrid = new GameGrid(canvas);
		registerEvents();
		getInititialValues();
		//MapGrid.drawMapObject(0, 1, "http://127.0.0.1:8020/RPG-API%20Client/WebContent/Door.png");
		
		// MapGrid.addClickedGridCellListener(function(point) {
			// MapGrid.changeCellSize(25, "gridOnResize");
		// });
	}
	
	function registerEvents() {
		gameGrid.on("canvasWidthChanged", function(newCanvasWidth) {
			$("#canvasWidthSpinner").val(newCanvasWidth);
		});
		
		gameGrid.on("canvasHeightChanged", function(newCanvasHeight) {
			$("#canvasHeightSpinner").val(newCanvasHeight);
		});
		
		gameGrid.on("gridColumnsChanged", function(newGridColumns) {
			$("#gridColumnSpinner").val(newGridColumns);
		});
		
		gameGrid.on("gridRowsChanged", function(newGridRows) {
			$("#gridRowSpinner").val(newGridRows);
		});		
		
		gameGrid.on("cellSizeChanged", function(newCellSize) {
			$("#cellSizeSpinner").val(newCellSize);
		});
		
		gameGrid.on("lineWidthChanged", function(newLineWidth) {
			$("#lineWidthSpinner").val(newLineWidth);
		});
	}
	
	function getInititialValues() {
		$("#canvasWidthSpinner").val(gameGrid.getCanvasWidth());
		$("#canvasHeightSpinner").val(gameGrid.getCanvasHeight());
		$("#gridColumnSpinner").val(gameGrid.getGridColumns());
		$("#gridRowSpinner").val(gameGrid.getGridRows());
		$("#cellSizeSpinner").val(gameGrid.getCellSize());
		$("#lineWidthSpinner").val(gameGrid.getLineWidth());
		//document.getElementById('lineWidthFunction').value = gameGrid.getLineWidthFunction();
		
		document.getElementById('minCanvasWidth').value = gameGrid.getMinCanvasWidth();
		document.getElementById('maxCanvasWidth').value = gameGrid.getMaxCanvasWidth();
		document.getElementById('minCanvasHeight').value = gameGrid.getMinCanvasHeight();
		document.getElementById('maxCanvasHeight').value = gameGrid.getMaxCanvasHeight();
		document.getElementById('minGridColumns').value = gameGrid.getMinGridColumns();
		document.getElementById('maxGridColumns').value = gameGrid.getMaxGridColumns();
		document.getElementById('minGridRows').value = gameGrid.getMinGridRows();
		document.getElementById('maxGridRows').value = gameGrid.getMaxGridRows();
		document.getElementById('minCellSize').value = gameGrid.getMinCellSize();
		document.getElementById('maxCellSize').value = gameGrid.getMaxCellSize();
		document.getElementById('minLineWidth').value = gameGrid.getMinLineWidth();		
		document.getElementById('maxLineWidth').value = gameGrid.getMaxLineWidth();
		
		$("#backgroundColorPicker").val(gameGrid.getBackgroundColor());
		$("#backgroundOpacityLabel").val(gameGrid.getBackgroundOpacity());
		$("#backgroundOpacitySlider").slider( "option", "value", gameGrid.getBackgroundOpacity());
		$("#lineColorPicker").val(gameGrid.getLineColor());
		$("#lineOpacityLabel").val(gameGrid.getLineOpacity());
		$("#lineOpacitySlider").slider( "option", "value", gameGrid.getLineOpacity());
	}
	
	//initialize accordion component from jquery-ui
	$(function() {
		$("#accordion").accordion({
			autoHeight: false
		});
		
		$("#canvasWidthSpinner").spinner({
			change: function() { 
				gameGrid.changeCanvasWidth($("#canvasWidthSpinner").val(), getResizingOption()); 
			}
		});
		
		$("#canvasHeightSpinner").spinner({
			change: function() { 
				gameGrid.changeCanvasHeight($("#canvasHeightSpinner").val(), getResizingOption()); 
			}
		});
		
		$("#gridColumnSpinner").spinner({
			change: function() { 
				gameGrid.changeGridColumns($("#gridColumnSpinner").val(), getResizingOption()); 
			}
		});
		
		$("#gridRowSpinner").spinner({
			change: function() { 
				gameGrid.changeGridRows($("#gridRowSpinner").val(), getResizingOption()); 
			}
		});
		
		$("#cellSizeSpinner").spinner({
			change: function() { 
				gameGrid.changeCellSize($("#cellSizeSpinner").val(), getResizingOption()); 
			}
		});
		
		var lineWidthSpinner = $("#lineWidthSpinner").spinner(
		);
		
		lineWidthSpinner.spinner( "disable" );
		
		$("#backgroundOpacitySlider").slider(
			{value: 0,
			min: 0,
			max: 1,
			step: 0.01,
			slide: function( event, ui ) {
				$("#backgroundOpacityLabel").val(ui.value);
				gameGrid.changeBackgroundOpacity(ui.value);
			}
		});
		
		$("#lineOpacitySlider").slider(
			{value: 0,
			min: 0,
			max: 1,
			step: 0.01,
			slide: function( event, ui ) {
				$( "#lineOpacityLabel" ).val(ui.value);
				gameGrid.changeLineOpacity(ui.value);
			}
		});
	});
	
	
	
	function getResizingOption() {
		var resizingOptions = document.getElementsByName("resizingOption");
		
		for (var i = 0; i < resizingOptions.length; i++) {
			var resizingOption = resizingOptions[i];
			if (resizingOption.checked) {
				return resizingOption.value;
			}
		}
	}
	
	function windowResized() {
		var newWidth = $(window).width();
		var newHeight = $(window).height();
		
		//mapGrid.setCanvasWidth(newWidth);
	}
	
	function keyPressed(evt) {
       var charCode = evt.which;
       var charStr = String.fromCharCode(charCode);
       
       switch (charStr) {
       	case "a":
	       	var x = gameGrid.getGridColumns();
	       	gameGrid.setGridColumns(x + 1);

       	break;
       }
   };

	window.onresize = windowResized;

</script>
<body onLoad="init();">
<h1>Gamegrid.js (Sandbox)</h1>
<table>
  <tr><td>
  
<div id="accordion">
    <h3><a href="#">Parameters</a></h3>  
<div> 
Resizing Options:
<form name="ResizingOptions">
  <label><input type="radio" name="resizingOption" value="canvasOnResize" checked>Dynamic Canvas Height and Width</label>
  <br>
  <label><input type="radio" name="resizingOption" value="gridOnResize">Dynamic Grid Columns and Rows</label>
  <br>
  <label><input type="radio" name="resizingOption" value="cellSizeOnResize">Dynamic Cell Size</label>
  <br>
  <label><input type="radio" name="resizingOption" value="none">None</label>
  <br>
</form>
<br>
<table>
  <tr>
    <td><label for="canvasWidthSpinner">Canvas Width:</label></td>
	<td><input id="canvasWidthSpinner" class="spinner"></td>
  </tr>
  <tr>
    <td><label for="canvasHeightSpinner">Canvas Height:</label></td>
	<td><input id="canvasHeightSpinner" class="spinner"></td>
  </tr> 
  <tr>
    <td><label for="gridColumnSpinner">Grid Columns:</label></td>
	<td><input id="gridColumnSpinner" class="spinner"></td>
  </tr>
  <tr>
    <td><label for="gridRowSpinner">Grid Rows:</label></td>
	<td><input id="gridRowSpinner" class="spinner"></td>
  </tr>
  <tr>
    <td><label for="cellSizeSpinner">Cell Size:</label></td>
	<td><input id="cellSizeSpinner" class="spinner"></td>  
  </tr>  
  <tr>
    <td><label for="lineWidth">Line Width:</label></td>
    <td><input id="lineWidthSpinner" class="spinner"></td>
  </tr>  
</table>
<br>
Current Line Width Function:<br>
<textarea id="lineWidthFunction" rows="5" cols="30"></textarea><br>
<input type="button" value="change" onClick="gameGrid.changeLineWidthFunction(document.getElementById('lineWidthFunction').value);"><br>
</div><!-- Parameters -->

    <h3><a href="#">Parameter Boundaries</a></h3>
    <div>

<table>
  <tr>
    <td>Minimum Canvas Width:</td>
    <td><input id="minCanvasWidth" type="text" size="3"></td>
    <td><input type="button" value="change" onClick="gameGrid.setMinCanvasWidth(document.getElementById('minCanvasWidth').value);"></td>
  </tr>
  <tr>
    <td>Maximum Canvas Width:</td>
    <td><input id="maxCanvasWidth" type="text" size="3"></td>
    <td><input type="button" value="change" onClick="gameGrid.setMaxCanvasWidth(document.getElementById('maxCanvasWidth').value);"></td>
  </tr>
  <tr>
    <td>Minimum Canvas Height:</td>
    <td><input id="minCanvasHeight" type="text" size="3"></td>
    <td><input type="button" value="change" onClick="gameGrid.setMinCanvasHeight(document.getElementById('minCanvasHeight').value);"></td>
  </tr>
  <tr>
    <td>Maximum Canvas Height:</td>
    <td><input id="maxCanvasHeight" type="text" size="3"></td>
    <td><input type="button" value="change" onClick="gameGrid.setMaxCanvasHeight(document.getElementById('maxCanvasHeight').value);"></td>
  </tr>
  <tr>
    <td>Minimum Grid Columns:</td>
    <td><input id="minGridColumns" type="text" size="3"></td>
    <td><input type="button" value="change" onClick="gameGrid.setMinGridColumns(document.getElementById('minGridColumns').value);"></td>
  </tr>
  <tr>
    <td>Maximum Grid Columns:</td>
    <td><input id="maxGridColumns" type="text" size="3"></td>
    <td><input type="button" value="change" onClick="gameGrid.setMaxGridColumns(document.getElementById('maxGridColumns').value);"></td>
  </tr>
  <tr>
    <td>Minimum Grid Rows:</td>
    <td><input id="minGridRows" type="text" size="3"></td>
    <td><input type="button" value="change" onClick="gameGrid.setMinGridRows(document.getElementById('minGridRows').value);"></td>
  </tr>
  <tr>
    <td>Maximum Grid Rows:</td>
    <td><input id="maxGridRows" type="text" size="3"></td>
    <td><input type="button" value="change" onClick="gameGrid.setMaxGridRows(document.getElementById('maxGridRows').value);"></td>
  </tr>  
  <tr>
    <td>Minimum Cell Size:</td>
    <td><input id="minCellSize" type="text" size="3"></td>
    <td><input type="button" value="change" onClick="gameGrid.setMinCellSize(document.getElementById('minCellSize').value);"></td>
  </tr>
  <tr>
    <td>Maximum Cell Size:</td>
    <td><input id="maxCellSize" type="text" size="3"></td>
    <td><input type="button" value="change" onClick="gameGrid.setMaxCellSize(document.getElementById('maxCellSize').value);"></td>
  </tr>
  <tr>
    <td>Minimum Line Width:</td>
    <td><input id="minLineWidth" type="text" size="3"></td>
    <td><input type="button" value="change" onClick="gameGrid.setMinLineWidth(document.getElementById('minLineWidth').value);"></td>
  </tr>
  <tr>
    <td>Maximum Line Width:</td>
    <td><input id="maxLineWidth" type="text" size="3"></td>
    <td><input type="button" value="change" onClick="gameGrid.setMaxLineWidth(document.getElementById('maxLineWidth').value);"></td>
  </tr>
</table>
</div> <!-- Parameter boundaries -->

    <h3><a href="#">Layout</a></h3>
    <div>
<table>
  <tr>
    <td>Background Color:</td>
    <td><input class="color {hash:true, pickerClosable:true}" id="backgroundColorPicker" onchange= "gameGrid.changeBackgroundColor(document.getElementById('backgroundColorPicker').value); "></td>
  </tr>  
  <tr>
    <td>Background Opacity:</td>
	<td><div id="backgroundOpacitySlider"></div><input type="text" id="backgroundOpacityLabel" style="border:0"></td>
  </tr>
  <tr>
    <td>Line color:</td>
    <td><input class="color {hash:true, pickerClosable:true}" id="lineColorPicker" onchange= "gameGrid.changeLineColor(document.getElementById('lineColorPicker').value) "></td>
  </tr>
  <tr>
    <td>Line Opacity:</td>
	<td><div id="lineOpacitySlider"></div><input type="text" id="lineOpacityLabel" style="border:0"></td>
  </tr>
</table>

</div> <!-- Layout -->
<h3><a href="#">Rest</a></h3>
<div>

Game To Grid Coordinatesystem Conversion Matrix:<br>
<input id="matrix" type="text" size="30"><input type="button" value="change" onClick="gameGrid.changeMatrix(document.getElementById('matrix').value);"><br>
<br>
Add Image to Grid:<br>
X Coordinate (in game): <input id="imageX" type="text" size="3"><br>
Y Coordinate (in game): <input id="imageY" type="text" size="3"><br>
URL: <input id="imageURL" type="text" size="20"><br>
<input type="button" value="add" onClick="gameGrid.addImage(document.getElementById('imageX').value, document.getElementById('imageY').value, document.getElementById('imageURL').value);"><br>
<br>
Move Grid (relative):<br>
X Coordinate: <input id="moveX" type="text" size="3"><br>
Y Coordinate: <input id="moveY" type="text" size="3"><br>
<input type="button" value="move" onClick="gameGrid.moveGrid(document.getElementById('moveX').value, document.getElementById('moveY').value);"><br>
<br>
Center Grid At:<br>
X Coordinate: <input id="centerX" type="text" size="3"><br>
Y Coordinate: <input id="centerY" type="text" size="3"><br>
<input type="button" value="center" onClick="gameGrid.centerGrid(document.getElementById('centerX').value, document.getElementById('centerY').value);"><br>
<br>
<input type="button" value="Rotate Grid 90° (clockwise)" onClick="gameGrid.rotate90DegreesClockwise();"><br>
<input type="button" value="Rotate Grid 90° (anti-clockwise)" onClick="gameGrid.rotate90DegreesAntiClockwise();"><br>
<input type="button" value="Rotate Grid 180°" onClick="gameGrid.rotate180Degrees();"><br>
</td>
</div> <!-- Rest -->
</div> <!-- accordion -->

<td>
  <canvas id="canvas" tabindex="1">
  This text is displayed if your browser does not support HTML5 Canvas.
  </canvas>
</td>
  </tr>
</table>
</html>